<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>תבנית המצאפדיה - למילוי</title>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #74b9ff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 0;
            padding: 20px;
            line-height: 1.8;
        }

        .book-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .page {
            padding: 40px;
            min-height: 500px;
            border-bottom: 3px solid #eee;
            page-break-after: always;
        }

        .page:last-child {
            border-bottom: none;
        }

        /* דף בחירת צבעים */
        .color-selection-page {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #2c3e50;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 600px;
        }

        .color-selection-page h1 {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .color-selection-page .subtitle {
            font-size: 1.3em;
            margin-bottom: 40px;
            opacity: 0.8;
            max-width: 600px;
            line-height: 1.6;
        }

        .color-picker-section {
            background: rgba(255,255,255,0.9);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 600px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .color-picker-row {
            display: flex;
            align-items: center;
            margin: 20px 0;
            gap: 20px;
        }

        .color-picker-row label {
            font-weight: bold;
            min-width: 100px;
            font-size: 1.1em;
        }

        .color-input {
            width: 60px;
            height: 60px;
            border: 3px solid #ddd;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }

        .color-input:hover {
            transform: scale(1.1);
            border-color: #333;
        }

        .color-preview {
            flex: 1;
            height: 40px;
            border-radius: 20px;
            border: 2px solid rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .start-button {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.3em;
            cursor: pointer;
            margin-top: 30px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-weight: bold;
        }

        .start-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .color-inspiration {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .inspiration-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .inspiration-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #333;
        }

        .inspiration-colors {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .inspiration-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .inspiration-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .inspiration-desc {
            font-size: 0.9em;
            color: #666;
        }

        .cover-page {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .cover-page h1 {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .cover-page .subtitle {
            font-size: 1.5em;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .info-form {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 500px;
        }

        .chapter-title {
            color: var(--primary-color);
            font-size: 2.2em;
            margin-bottom: 25px;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-right: 5px solid var(--primary-color);
        }

        .form-section h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .text-area {
            min-height: 100px;
            resize: vertical;
        }

        .text-area-large {
            min-height: 150px;
        }

        .drawing-area {
            background: #ffffff;
            border: 3px solid var(--primary-color);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin: 25px 0;
            min-height: 400px;
            display: flex;
            align-items: stretch;
            justify-content: center;
            flex-direction: row;
            gap: 20px;
        }

        .drawing-canvas-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .drawing-canvas {
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: crosshair;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .drawing-tools {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #ddd;
            min-width: 80px;
        }

        .color-tool {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            font-size: 0.7em;
        }

        .color-tool:hover {
            transform: scale(1.1);
            border-color: #333;
        }

        .color-tool.active {
            border-color: #000;
            transform: scale(1.2);
        }

        .eraser-tool {
            width: 50px;
            height: 50px;
            background: #fff;
            border: 3px solid #333;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .eraser-tool:hover {
            transform: scale(1.1);
            background: #f0f0f0;
        }

        .eraser-tool.active {
            background: #e0e0e0;
            transform: scale(1.2);
        }

        .clear-button {
            width: 50px;
            height: 30px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: bold;
        }

        .clear-button:hover {
            background: #ff3742;
        }

        .drawing-instructions {
            color: #666;
            font-size: 1em;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .parts-section {
            background: #f0f8ff;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            border: 2px solid var(--primary-color);
        }

        .parts-list {
            list-style: none;
            padding: 0;
        }

        .parts-list li {
            background: white;
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            border-right: 4px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .parts-list li::before {
            content: "🔧";
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .parts-input {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px;
            font-size: 0.9em;
        }

        .tip-box {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-right: 5px solid #e17055;
        }

        .tip-box h4 {
            margin: 0 0 10px 0;
            color: #2d3436;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tip-box h4::before {
            content: "💡";
            font-size: 1.3em;
        }

        .future-section {
            background: linear-gradient(135deg, var(--accent-color), var(--primary-color));
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .future-section h3 {
            color: white;
            margin-bottom: 20px;
        }

        .future-input {
            background: rgba(255,255,255,0.9);
            border: none;
            color: #333;
        }

        .checklist {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4caf50;
        }

        .checklist h4 {
            color: #2e7d32;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checklist h4::before {
            content: "✓";
            background: #4caf50;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
        }
.navigation {
    text-align: center;
    margin: 20px 0;
    display: none; /* הוסף את השורה הזו */
}

        .btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .hidden {
            display: none !important;
        }

@media print {
    .navigation { display: none; }
    .page { page-break-after: always; }
    body { background: white; direction: rtl; }
    .book-container { box-shadow: none; direction: rtl; }
    .color-selection-page { display: none; }
    * { direction: rtl !important; }
}
    </style>
</head>
<body>
    <div class="book-container">
        <!-- דף בחירת צבעים -->
        <div class="page color-selection-page" id="colorSelectionPage">
            <h1>ברוכים הבאים להמצאפדיה! 🎨</h1>
            <div class="subtitle">
                לפני שמתחילים -<br>
                בחרו 3 צבעים שייהיו הבסיס לעיצוב של ספר הפרויקט שלכם.<br>
                תחשבו על צבעים שמייצגים את ההמצאה שלכם – מצחיקים? טכנולוגיים? טבעיים? מפתיעים?
            </div>
            
            <div class="color-picker-section">
                <h3>בחרו את הצבעים שלכם:</h3>
                
                <div class="color-picker-row">
                    <label>צבע 1:</label>
                    <input type="color" class="color-input" id="color1" value="#667eea" onchange="updateColorPreview(1)">
                    <div class="color-preview" id="preview1" style="background: #667eea;">צבע ראשי</div>
                </div>
                
                <div class="color-picker-row">
                    <label>צבע 2:</label>
                    <input type="color" class="color-input" id="color2" value="#764ba2" onchange="updateColorPreview(2)">
                    <div class="color-preview" id="preview2" style="background: #764ba2;">צבע משני</div>
                </div>
                
                <div class="color-picker-row">
                    <label>צבע 3:</label>
                    <input type="color" class="color-input" id="color3" value="#74b9ff" onchange="updateColorPreview(3)">
                    <div class="color-preview" id="preview3" style="background: #74b9ff;">צבע הדגשה</div>
                </div>

                <h4>או בחרו מהרעיונות שלנו:</h4>
                <div class="color-inspiration">
                    <div class="inspiration-card" onclick="applyColorTheme('#e74c3c', '#c0392b', '#f39c12')">
                        <div class="inspiration-colors">
                            <div class="inspiration-color" style="background: #e74c3c;"></div>
                            <div class="inspiration-color" style="background: #c0392b;"></div>
                            <div class="inspiration-color" style="background: #f39c12;"></div>
                        </div>
                        <div class="inspiration-title">אנרגטי</div>
                        <div class="inspiration-desc">אדום, בורדו וכתום</div>
                    </div>
                    
                    <div class="inspiration-card" onclick="applyColorTheme('#27ae60', '#16a085', '#2ecc71')">
                        <div class="inspiration-colors">
                            <div class="inspiration-color" style="background: #27ae60;"></div>
                            <div class="inspiration-color" style="background: #16a085;"></div>
                            <div class="inspiration-color" style="background: #2ecc71;"></div>
                        </div>
                        <div class="inspiration-title">טבעי</div>
                        <div class="inspiration-desc">ירוק, טורקיז ורענן</div>
                    </div>
                    
                    <div class="inspiration-card" onclick="applyColorTheme('#8e44ad', '#9b59b6', '#e67e22')">
                        <div class="inspiration-colors">
                            <div class="inspiration-color" style="background: #8e44ad;"></div>
                            <div class="inspiration-color" style="background: #9b59b6;"></div>
                            <div class="inspiration-color" style="background: #e67e22;"></div>
                        </div>
                        <div class="inspiration-title">יצירתי</div>
                        <div class="inspiration-desc">סגול, ורוד וכתום</div>
                    </div>
                    
                    <div class="inspiration-card" onclick="applyColorTheme('#34495e', '#2c3e50', '#3498db')">
                        <div class="inspiration-colors">
                            <div class="inspiration-color" style="background: #34495e;"></div>
                            <div class="inspiration-color" style="background: #2c3e50;"></div>
                            <div class="inspiration-color" style="background: #3498db;"></div>
                        </div>
                        <div class="inspiration-title">טכנולוגי</div>
                        <div class="inspiration-desc">אפור, כהה וכחול</div>
                    </div>
                </div>
                
                <button class="start-button" onclick="startInventopedia()">
                    🚀 בואו נתחיל ליצור!
                </button>
            </div>
        </div>

        <!-- דף שער -->
        <div class="page cover-page hidden" id="page0">
            <h1>המצאפדיה</h1>
            <div class="subtitle">המדריך הסודי של כל ממציא צעיר</div>
            <div class="info-form">
                <input type="text" class="input-field" placeholder="שם ההמצאה שלכם (משהו קליט ומעניין!)" style="font-size: 1.3em; font-weight: bold; text-align: center; margin-bottom: 20px;">
                <input type="text" class="input-field" placeholder="שמות הממציאים (כל החברים בקבוצה)">
                <input type="text" class="input-field" placeholder="תאריך ההמצאה" value="29.05.2025" style="text-align: center;">
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px; text-align: center;">
                    <strong>פתרון יצירתי לבעיית עומסי תנועה</strong><br>
                    הממציא הצעיר 2025
                </div>
            </div>
        </div>

        <!-- פרק 1 -->
        <div class="page hidden" id="page1">
            <h2 class="chapter-title">פרק 1: מה ההמצאה שלנו?</h2>
            
            <div class="tip-box">
                <h4>טיפ לכתיבה</h4>
                <p>הסבירו כאילו אתם מספרים לחבר הכי טוב שלכם - פשוט, ברור ומעניין!</p>
            </div>

            <div class="form-section">
                <h3>מה היא עושה?</h3>
                <textarea class="input-field text-area-large" placeholder="תארו במילים פשוטות מה ההמצאה שלכם עושה. למשל: 'ההמצאה שלנו היא מערכת שמזהה...' או 'הרחפן שלנו מביא...'"></textarea>
            </div>

            <div class="form-section">
                <h3>איך היא עוזרת לנהגים?</h3>
                <textarea class="input-field text-area" placeholder="איך ההמצאה שלכם תעזור לפתור בעיות של נהגים? למשל: פחות פקקים, יותר בטיחות, חיסכון בזמן..."></textarea>
            </div>

            <div class="form-section">
                <h3>למה זה חשוב?</h3>
                <textarea class="input-field text-area" placeholder="למה העולם צריך את ההמצאה שלכם? מה יהיה שונה אחרי שתממשו אותה?"></textarea>
            </div>
        </div>

        <!-- פרק 2 -->
        <div class="page hidden" id="page2">
            <h2 class="chapter-title">פרק 2: ממה ההמצאה בנויה?</h2>
            
            <div class="parts-section">
                <h3>החלקים העיקריים:</h3>
                <ul class="parts-list">
                    <li><input type="text" class="parts-input" placeholder="חלק ראשון (למשל: חיישן תנועה)"> - <input type="text" class="parts-input" placeholder="מה הוא עושה?"></li>
                    <li><input type="text" class="parts-input" placeholder="חלק שני"> - <input type="text" class="parts-input" placeholder="מה הוא עושה?"></li>
                    <li><input type="text" class="parts-input" placeholder="חלק שלישי"> - <input type="text" class="parts-input" placeholder="מה הוא עושה?"></li>
                    <li><input type="text" class="parts-input" placeholder="חלק רביעי"> - <input type="text" class="parts-input" placeholder="מה הוא עושה?"></li>
                    <li><input type="text" class="parts-input" placeholder="חלק חמישי"> - <input type="text" class="parts-input" placeholder="מה הוא עושה?"></li>
                </ul>
            </div>

            <div class="form-section">
                <h3>החומרים שבחרנו:</h3>
                <textarea class="input-field text-area" placeholder="מאילו חומרים תבנו את ההמצאה? למשל: מתכת, פלסטיק, זכוכית... ולמה בחרתם בחומרים האלה?"></textarea>
            </div>

            <div class="tip-box">
                <h4>הרכיב הסודי שלכם</h4>
                <textarea class="input-field text-area" placeholder="מה הכי מיוחד וחכם בהמצאה שלכם? מה עושה אותה שונה מכל דבר אחר?"></textarea>
            </div>
        </div>

        <!-- פרק 3 -->
        <div class="page hidden" id="page3">
            <h2 class="chapter-title">פרק 3: איך הגענו לרעיון?</h2>
            
            <div class="form-section">
                <h3>הסיפור שהתחיל הכל:</h3>
                <textarea class="input-field text-area-large" placeholder="ספרו את הסיפור - איפה הייתם? מה קרה? מה גרם לכם לחשוב על הבעיה הזו? היו ספציפיים ומעניינים!"></textarea>
            </div>

            <div class="tip-box">
                <h4>הרגע של ההשראה</h4>
                <textarea class="input-field text-area" placeholder="מה היה הרגע הקסום שבו אמרתם 'זה זה!'? איך הגעתם לפתרון הספציפי הזה?"></textarea>
            </div>

            <div class="form-section">
                <h3>איך המשכנו לפתח את הרעיון:</h3>
                <textarea class="input-field text-area" placeholder="מה עשיתם אחרי שהגיע לכם הרעיון? איך חקרתם? עם מי דיברתם? מה גיליתם?"></textarea>
            </div>

            <div class="form-section">
                <h3>למה ההמצאה הזו חשובה לכם אישית?</h3>
                <textarea class="input-field text-area" placeholder="מה המוטיבציה שלכם? למה בחרתם לפתור בדיוק את הבעיה הזו?"></textarea>
            </div>
        </div>

        <!-- פרק 4 -->
        <div class="page hidden" id="page4">
            <h2 class="chapter-title">פרק 4: איך זה נראה?</h2>
            
            <div class="drawing-area">
                <div class="drawing-canvas-container">
                    <div class="drawing-instructions">
                        <h3>🎨 ציירו את ההמצאה שלכם כאן</h3>
                        <p>בחרו צבע מהצד וציירו!</p>
                    </div>
                    <canvas id="drawingCanvas" class="drawing-canvas" width="500" height="300"></canvas>
                </div>
                
                <div class="drawing-tools">
                    <div class="color-tool" style="background: #000;" data-color="#000000" onclick="selectTool('pen', '#000000')">שחור</div>
                    <div class="color-tool drawing-color-1" onclick="selectDrawingColor(1)">צבע 1</div>
                    <div class="color-tool drawing-color-2" onclick="selectDrawingColor(2)">צבע 2</div>
                    <div class="color-tool drawing-color-3" onclick="selectDrawingColor(3)">צבע 3</div>
                    <div class="color-tool" style="background: #2ecc71;" data-color="#2ecc71" onclick="selectTool('pen', '#2ecc71')">ירוק</div>
                    <div class="eraser-tool" onclick="selectTool('eraser', '#ffffff')">🧹</div>
                    <button class="clear-button" onclick="clearCanvas()">נקה</button>
                </div>
            </div>

            <div class="form-section">
                <h3>הסבר על הציור:</h3>
                <textarea class="input-field text-area" placeholder="הסבירו מה רואים בציור. תארו את החלקים החשובים ואיך הם עובדים יחד."></textarea>
            </div>

            <div class="form-section">
                <h3>איך זה עובד בפועל?</h3>
                <div style="margin-bottom: 15px;">
                    <input type="text" class="input-field" placeholder="שלב 1: מה קורה ראשון?">
                </div>
                <div style="margin-bottom: 15px;">
                    <input type="text" class="input-field" placeholder="שלב 2: מה קורה אחר כך?">
                </div>
                <div style="margin-bottom: 15px;">
                    <input type="text" class="input-field" placeholder="שלב 3: איך זה ממשיך?">
                </div>
                <div>
                    <input type="text" class="input-field" placeholder="שלב 4: מה התוצאה הסופית?">
                </div>
            </div>
        </div>

        <!-- פרק 5 -->
        <div class="page hidden" id="page5">
            <h2 class="chapter-title">פרק 5: מה מיוחד בהמצאה שלנו?</h2>
            
            <div class="form-section">
                <h3>מה שונה בזה מכל דבר אחר?</h3>
                <textarea class="input-field text-area" placeholder="איך ההמצאה שלכם שונה ממה שקיים היום? מה עושה אותה מיוחדת?"></textarea>
            </div>

            <div class="form-section">
                <h3>השוואה למה שקיים היום:</h3>
                <div style="margin-bottom: 15px;">
                    <label style="font-weight: bold;">פתרונות רגילים היום:</label>
                    <textarea class="input-field text-area" placeholder="איך אנשים פותרים את הבעיה הזו היום? מה הבעיות עם הפתרונות הקיימים?"></textarea>
                </div>
                <div>
                    <label style="font-weight: bold;">ההמצאה שלנו:</label>
                    <textarea class="input-field text-area" placeholder="למה הפתרון שלכם טוב יותר? מה היתרונות?"></textarea>
                </div>
            </div>

            <div class="tip-box">
                <h4>הדבר הכי מיוחד</h4>
                <textarea class="input-field text-area" placeholder="מה הכי גרנדיוזי ומרתק בהמצאה שלכם? מה יגרום לאנשים לומר 'וואו!'?"></textarea>
            </div>

            <div class="form-section">
                <h3>למה זה מהפכני?</h3>
                <textarea class="input-field text-area" placeholder="איך ההמצאה שלכם תשנה את העולם? מה יהיה אחרת אחרי שהיא תתממש?"></textarea>
            </div>
        </div>

        <!-- פרק 6 -->
        <div class="page hidden" id="page6">
            <h2 class="chapter-title">פרק 6: מחשבות לעתיד</h2>
            
            <div class="future-section">
                <h3>החלומות שלנו - מה נוסיף עם תקציב ענק ושנה נוספת:</h3>
                <textarea class="input-field future-input text-area-large" placeholder="אם הייתם יכולים לשדרג את ההמצאה ללא הגבלות - מה הייתם מוסיפים? תחלמו בגדול!"></textarea>
            </div>

            <div class="form-section">
                <h3>שדרוגים טכניים:</h3>
                <textarea class="input-field text-area" placeholder="איזה טכנולוגיות חדשות תוסיפו? מה תשפרו? איך תעשו את זה עוד יותר חכם?"></textarea>
            </div>

            <div class="form-section">
                <h3>הרחבה לעולם:</h3>
                <textarea class="input-field text-area" placeholder="איך תפיצו את ההמצאה לכל העולם? באילו מדינות זה יעבוד הכי טוב? איך תתאימו לתרבויות שונות?"></textarea>
            </div>

            <div class="tip-box">
                <h4>המטרה הגדולה</h4>
                <textarea class="input-field text-area" placeholder="מה החלום הגדול שלכם? איך ההמצאה תעזור לאנשים? מה השינוי שאתם רוצים לראות בעולם?"></textarea>
            </div>

            <div class="form-section">
                <h3>מסר לעתיד:</h3>
                <textarea class="input-field text-area" placeholder="מה הייתם רוצים לומר לעצמכם בעוד 10 שנים? איזה מסר לעתיד?"></textarea>
            </div>
        </div>

        <!-- עמוד בדיקה אחרון -->
        <div class="page hidden" id="finalPage">
            <h2 class="chapter-title">✓ בדיקה אחרונה לפני ההגשה</h2>
            
            <div class="checklist">
                <h4>רשימת בדיקה - ודאו שכל הבאים מופיעים בספר:</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div>
                        <label><input type="checkbox"> דף שער עם כל הפרטים</label><br>
                        <label><input type="checkbox"> הסבר ברור מה ההמצאה עושה</label><br>
                        <label><input type="checkbox"> רשימת החלקים והחומרים</label><br>
                        <label><input type="checkbox"> סיפור איך הגעתם לרעיון</label><br>
                    </div>
                    <div>
                        <label><input type="checkbox"> ציור או תרשים של ההמצאה</label><br>
                        <label><input type="checkbox"> הסבר למה זה מיוחד</label><br>
                        <label><input type="checkbox"> חזון לעתיד</label><br>
                        <label><input type="checkbox"> הכל כתוב בצורה ברורה וקריאה</label><br>
                    </div>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #00b894, #00a085); color: white; padding: 25px; border-radius: 15px; text-align: center; margin: 30px 0;">
                <h2 style="margin: 0 0 15px 0; color: white;">🎉 כל הכבוד! 🎉</h2>
                <p style="font-size: 1.2em; margin: 0;">סיימתם את המצאפדיה הראשונה שלכם!</p>
                <p style="margin: 10px 0 0 0;">עכשיו אתם ממציאים רשמיים עם ספר פרויקט מקצועי!</p>
            </div>

            <div style="border: 3px solid var(--primary-color); border-radius: 15px; padding: 20px; text-align: center;">
                <h3 style="color: var(--primary-color); margin-bottom: 15px;">הכנה להצגה:</h3>
                <p>כעת תוכלו להציג את ההמצאה שלכם בפני השופטים!</p>
                <p><strong>זכרו:</strong> המצאפדיה הזו היא הכרטיס ביקור של ההמצאה שלכם</p>
            </div>
        </div>
    </div>

    <div class="navigation">
        <button class="btn" onclick="downloadPDF()">📥 הורדה</button>
        <button class="btn" onclick="uploadToFirebase()">🔥 שלחו להדפסה (חובה!)</button>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-storage.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCe24QH6BXEWtF2zJWcP8WhV8qKj-3l-00",
            authDomain: "gaash-2ea82.firebaseapp.com",
            projectId: "gaash-2ea82",
            storageBucket: "gaash-2ea82.firebasestorage.app",
            messagingSenderId: "1054252503536",
            appId: "1:1054252503536:web:4b7c546bd737de696e4d35"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // Make Firebase functions available globally
        window.firebaseStorage = storage;
        window.firebaseRef = ref;
        window.firebaseUpload = uploadBytesResumable;
        window.firebaseGetDownloadURL = getDownloadURL;
    </script>

    <script>
        // משתנים לציור
        let canvas, ctx;
        let isDrawing = false;
        let currentTool = 'pen';
        let currentColor = '#000000';
        let currentSize = 3;
        let selectedColors = {
            color1: '#667eea',
            color2: '#764ba2',
            color3: '#74b9ff'
        };

        // פונקציות לבחירת צבעים
        function updateColorPreview(colorNum) {
            const colorInput = document.getElementById(`color${colorNum}`);
            const preview = document.getElementById(`preview${colorNum}`);
            const color = colorInput.value;
            
            preview.style.background = color;
            selectedColors[`color${colorNum}`] = color;
            
            // עדכון הצבעים בכלי הציור
            updateDrawingTools();
        }

        function applyColorTheme(color1, color2, color3) {
            document.getElementById('color1').value = color1;
            document.getElementById('color2').value = color2;
            document.getElementById('color3').value = color3;
            
            selectedColors.color1 = color1;
            selectedColors.color2 = color2;
            selectedColors.color3 = color3;
            
            updateColorPreview(1);
            updateColorPreview(2);
            updateColorPreview(3);
        }

        function updateDrawingTools() {
            const drawingColor1 = document.querySelector('.drawing-color-1');
            const drawingColor2 = document.querySelector('.drawing-color-2');
            const drawingColor3 = document.querySelector('.drawing-color-3');
            
            if (drawingColor1) {
                drawingColor1.style.background = selectedColors.color1;
                drawingColor1.setAttribute('data-color', selectedColors.color1);
            }
            if (drawingColor2) {
                drawingColor2.style.background = selectedColors.color2;
                drawingColor2.setAttribute('data-color', selectedColors.color2);
            }
            if (drawingColor3) {
                drawingColor3.style.background = selectedColors.color3;
                drawingColor3.setAttribute('data-color', selectedColors.color3);
            }
        }

        function selectDrawingColor(colorNum) {
            const color = selectedColors[`color${colorNum}`];
            selectTool('pen', color);
        }

        function startInventopedia() {
            // עדכון משתני CSS עם הצבעים שנבחרו
            document.documentElement.style.setProperty('--primary-color', selectedColors.color1);
            document.documentElement.style.setProperty('--secondary-color', selectedColors.color2);
            document.documentElement.style.setProperty('--accent-color', selectedColors.color3);
            
            // הסתרת דף בחירת הצבעים והצגת הספר
            document.getElementById('colorSelectionPage').classList.add('hidden');
            document.querySelectorAll('.page.hidden').forEach(page => {
                if (page.id !== 'colorSelectionPage') {
                    page.classList.remove('hidden');
                }
            });
            
            // אתחול הציור עם הצבעים החדשים
            setTimeout(() => {
                initDrawing();
                updateDrawingTools();
                selectTool('pen', '#000000');
            }, 100);
            
            // שמירת הצבעים ב-localStorage
            localStorage.setItem('inventopediaColors', JSON.stringify(selectedColors));
            document.querySelector('.navigation').style.display = 'block';

        }

        // אתחול הציור
        function initDrawing() {
            canvas = document.getElementById('drawingCanvas');
            if (!canvas) return;
            
            ctx = canvas.getContext('2d');
            
            // הגדרות בסיסיות
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.lineWidth = currentSize;
            
            // אירועי עכבר
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // אירועי מגע (לטאבלטים)
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            if (currentTool === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = 20;
            } else {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = currentColor;
                ctx.lineWidth = currentSize;
            }
            
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath();
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function selectTool(tool, color) {
            currentTool = tool;
            currentColor = color;
            
            // עדכון העיצוב של הכלים
            document.querySelectorAll('.color-tool, .eraser-tool').forEach(el => {
                el.classList.remove('active');
            });
            
            if (tool === 'eraser') {
                document.querySelector('.eraser-tool').classList.add('active');
            } else {
                const colorTool = document.querySelector(`[data-color="${color}"]`);
                if (colorTool) {
                    colorTool.classList.add('active');
                }
            }
        }

        function clearCanvas() {
            if (confirm('האם אתם בטוחים שאתם רוצים למחוק את כל הציור?')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        // שמירת התקדמות עם הציור והצבעים
        function saveProgressSilent() {
            const inputs = document.querySelectorAll('input, textarea');
            const data = {
                colors: selectedColors,
                inputs: {}
            };
            
            inputs.forEach((input, index) => {
                data.inputs[index] = input.value;
            });
            
            // שמירת הציור
            if (canvas) {
                data.drawing = canvas.toDataURL();
            }
            
            localStorage.setItem('inventionBook', JSON.stringify(data));
            console.log('התקדמות נשמרה אוטומטית');
        }

        // שמירת התקדמות עם הציור והצבעים (עם התראה)
        function saveProgress() {
            const inputs = document.querySelectorAll('input, textarea');
            const data = {
                colors: selectedColors,
                inputs: {}
            };
            
            inputs.forEach((input, index) => {
                data.inputs[index] = input.value;
            });
            
            // שמירת הציור
            if (canvas) {
                data.drawing = canvas.toDataURL();
            }
            
            localStorage.setItem('inventionBook', JSON.stringify(data));
            alert('ההתקדמות נשמרה בהצלחה! 💾');
        }

        // טעינת התקדמות עם הציור והצבעים
        function loadProgress() {
            const savedData = localStorage.getItem('inventionBook');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // טעינת הצבעים
                if (data.colors) {
                    selectedColors = data.colors;
                    document.getElementById('color1').value = selectedColors.color1;
                    document.getElementById('color2').value = selectedColors.color2;
                    document.getElementById('color3').value = selectedColors.color3;
                    updateColorPreview(1);
                    updateColorPreview(2);
                    updateColorPreview(3);
                }
                
                // טעינת הטקסטים
                if (data.inputs) {
                    const inputs = document.querySelectorAll('input, textarea');
                    inputs.forEach((input, index) => {
                        if (data.inputs[index]) {
                            input.value = data.inputs[index];
                        }
                    });
                }
                
                // טעינת הציור
                if (data.drawing && canvas) {
                    const img = new Image();
                    img.onload = function() {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        ctx.drawImage(img, 0, 0);
                    };
                    img.src = data.drawing;
                }
            }
        }

        // שמירה אוטומטית שקטה כל 30 שניות
        setInterval(saveProgressSilent, 30000);

        // טעינה בעת פתיחת הדף
        document.addEventListener('DOMContentLoaded', function() {
            // טעינת התקדמות
            loadProgress();
            
            // הסרת placeholder בעת כתיבה
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.style.fontStyle = 'normal';
                });
            });
        });

        // הוספת מדד התקדמות
        function updateProgressIndicator() {
            const inputs = document.querySelectorAll('input, textarea');
            const filledInputs = Array.from(inputs).filter(input => input.value.trim() !== '');
            const progress = Math.round((filledInputs.length / inputs.length) * 100);
            
            console.log(`התקדמות: ${progress}% (${filledInputs.length}/${inputs.length} שדות מלאים)`);
        }

        // עדכון התקדמות בכל שינוי
        document.addEventListener('input', updateProgressIndicator);

        // פונקציות הורדה והעלאה
        async function downloadPDF() {
            try {
                // הסתרת דף בחירת הצבעים ובר הניווט
                const colorPage = document.getElementById('colorSelectionPage');
                const navigation = document.querySelector('.navigation');
                const originalColorDisplay = colorPage.style.display;
                const originalNavDisplay = navigation.style.display;
                
                colorPage.style.display = 'none';
                navigation.style.display = 'none';
document.body.style.direction = 'rtl';
document.documentElement.style.direction = 'rtl';
const allElements = document.querySelectorAll('*');
allElements.forEach(el => {
    el.style.direction = 'rtl';
    el.style.textAlign = 'right';
});
                // יצירת PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                // קבלת כל הדפים (למעט דף בחירת הצבעים)
                const pages = document.querySelectorAll('.page:not(#colorSelectionPage)');
                
                for (let i = 0; i < pages.length; i++) {
                    const page = pages[i];
                    
                    // הצגת הדף הנוכחי
                    page.classList.remove('hidden');
                    
                    // המתנה קצרה לרינדור
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    // יצירת תמונה מהדף
const canvas = await html2canvas(page, {
    scale: 1,
    useCORS: true,
    allowTaint: false,
    backgroundColor: '#ffffff',
    width: page.offsetWidth,
    height: page.offsetHeight,
    logging: false
});
                    
                    const imgData = canvas.toDataURL('image/png');
                    
                    // הוספת דף חדש ל-PDF (למעט הדף הראשון)
                    if (i > 0) {
                        pdf.addPage();
                    }
                    
                    // הוספת התמונה ל-PDF
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                    const imgX = (pdfWidth - imgWidth * ratio) / 2;
                    const imgY = 0;
                    
                    pdf.addImage(imgData, 'JPEG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
                }

                // קבלת שם הקבוצה
                const groupNameField = document.querySelector('input[placeholder*="שמות הממציאים"]');
                const groupName = groupNameField ? groupNameField.value.trim() : 'המצאפדיה';
                const fileName = groupName || 'המצאפדיה';

                // הורדת ה-PDF
                pdf.save(`${fileName}.pdf`);

                // החזרת התצוגה המקורית
                colorPage.style.display = originalColorDisplay;
                navigation.style.display = originalNavDisplay;
                // החזרת הכיוון המקורי
document.body.style.direction = '';
document.documentElement.style.direction = '';
allElements.forEach(el => {
    el.style.direction = '';
    el.style.textAlign = '';
});
                alert('קובץ ה-PDF הורד בהצלחה! 📥');

            } catch (error) {
                console.error('שגיאה ביצירת PDF:', error);
                alert('אירעה שגיאה ביצירת קובץ ה-PDF. נסו שוב.');
            }
        }

        async function uploadToFirebase() {
            try {
                // בדיקה שהכפתור זמין
                const uploadBtn = document.querySelector('button[onclick="uploadToFirebase()"]');
                uploadBtn.disabled = true;
                uploadBtn.innerHTML = '⏳ יוצר קובץ...';

                // יצירת PDF כמו בפונקציה הקודמת
                const colorPage = document.getElementById('colorSelectionPage');
                const navigation = document.querySelector('.navigation');
                const originalColorDisplay = colorPage.style.display;
                const originalNavDisplay = navigation.style.display;
                
                colorPage.style.display = 'none';
                navigation.style.display = 'none';
// כפיית כיוון RTL זמנית
document.body.style.direction = 'rtl';
document.documentElement.style.direction = 'rtl';
const allElements = document.querySelectorAll('*');
allElements.forEach(el => {
    el.style.direction = 'rtl';
    el.style.textAlign = 'right';
});
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                const pages = document.querySelectorAll('.page:not(#colorSelectionPage)');
                
                for (let i = 0; i < pages.length; i++) {
                    const page = pages[i];
                    page.classList.remove('hidden');
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
const canvas = await html2canvas(page, {
    scale: 1,
    useCORS: true,
    allowTaint: false,
    backgroundColor: '#ffffff',
    width: page.offsetWidth,
    height: page.offsetHeight,
    logging: false
});
                    
                    const imgData = canvas.toDataURL('image/jpeg', 0.8);
                    
                    if (i > 0) {
                        pdf.addPage();
                    }
                    
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = pdf.internal.pageSize.getHeight();
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                    const imgX = (pdfWidth - imgWidth * ratio) / 2;
                    const imgY = 0;
                    
                    pdf.addImage(imgData, 'JPEG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
                }

                // החזרת התצוגה המקורית
                colorPage.style.display = originalColorDisplay;
                navigation.style.display = originalNavDisplay;
// החזרת הכיוון המקורי
document.body.style.direction = '';
document.documentElement.style.direction = '';
allElements.forEach(el => {
    el.style.direction = '';
    el.style.textAlign = '';
});
                // קבלת שם הקבוצה
                const groupNameField = document.querySelector('input[placeholder*="שמות הממציאים"]');
                const groupName = groupNameField ? groupNameField.value.trim() : 'המצאפדיה';
                const fileName = groupName || `המצאפדיה_${Date.now()}`;

                // המרת PDF לבייטים
                const pdfBlob = pdf.output('blob');
                
                uploadBtn.innerHTML = '⬆️ מעלה לענן...';

                // העלאה ל-Firebase Storage
                const storageRef = window.firebaseRef(window.firebaseStorage, `books/${fileName}.pdf`);
                const uploadTask = window.firebaseUpload(storageRef, pdfBlob);

                uploadTask.on('state_changed', 
                    (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        uploadBtn.innerHTML = `⬆️ מעלה... ${Math.round(progress)}%`;
                    }, 
                    (error) => {
                        console.error('שגיאה בהעלאה:', error);
                        alert('שגיאה בהעלאה לענן. נסו שוב.');
                        uploadBtn.disabled = false;
                        uploadBtn.innerHTML = '🔥 שלחו להדפסה';
                    }, 
                    async () => {
                        try {
                            const downloadURL = await window.firebaseGetDownloadURL(uploadTask.snapshot.ref);
                            console.log('קובץ הועלה בהצלחה:', downloadURL);
                            
                            uploadBtn.innerHTML = '✅ נשלח בהצלחה!';
                            alert('הקובץ נשלח בהצלחה להדפסה! 🎉');
                            
                            setTimeout(() => {
                                uploadBtn.disabled = false;
                                uploadBtn.innerHTML = '🔥 שלחו להדפסה';
                            }, 3000);
                        } catch (error) {
                            console.error('שגיאה בקבלת URL:', error);
                            alert('הקובץ הועלה אך יש בעיה בקישור.');
                            uploadBtn.disabled = false;
                            uploadBtn.innerHTML = '🔥 שלחו להדפסה';
                        }
                    }
                );

            } catch (error) {
                console.error('שגיאה כללית:', error);
                alert('אירעה שגיאה. נסו שוב.');
                const uploadBtn = document.querySelector('button[onclick="uploadToFirebase()"]');
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '🔥 שלחו להדפסה';
            }
        }

        // הפיכת הפונקציות לגלובליות
        window.downloadPDF = downloadPDF;
        window.uploadToFirebase = uploadToFirebase;
    </script>
</body>
</html>
